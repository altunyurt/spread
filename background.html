<script src="jquery-1.7.min.js"></script>
<script>
    var defaults = {
                'fpm': 300,
                'chars': 10,
                'font': 24
            };
    chrome.contextMenus.create({'title':'Speed read selection', 
                "contexts":['selection'], "onclick": openReader})

    function getValue(item){
        var lsval = localStorage[item];
        if(lsval == null || lsval == undefined || lsval == "null"){
          return defaults[item];
        } 
      return lsval;
    };

    function openReader(){
        chrome.tabs.getSelected(null, function(tab) {
            chrome.tabs.sendRequest(tab.id, {command: "openReader"}, function(response) {
            });
        });
    };


    chrome.extension.onRequest.addListener(function(request, sender, sendResponse) {
        var conf = {}
        if (request.command == 'getSettings'){
            for (var item in defaults){
                if (item == undefined){
                    break;
                }
                conf[item] = getValue(item);
            
            }
            sendResponse({'settings':conf});
        } else if (request.command == 'saveSettings'){
            var data = request.settings_data;
            for(var item in data){
                if(item == undefined ){
                    break;
                }
                localStorage[item] = data[item]
            }
            sendResponse({});
        }
    });

</script>
